<section class="widget">
  <div class="body">
    <div class="block-header text-center text-capitalize">
      <h2><i class="md-file-download c-indigo"> Project Exports </i></h2>
    </div>
    <table class="table table-hover">
      <thead>
      <tr>
        <th>Project</th>
        <th>Date</th>
        <th>Long format</th>
        <th>Wide format</th>
        <th>Short format</th>
        <th>Pictures</th>
        <th>% Complete</th>
      </tr>
      </thead>
      <tbody>
      <% @project_exports.each do |export| %>
          <tr>
            <td><%= link_to current_project.name, project_path(export.try(:project_id)) %></td>
            <td><%= export.created_at.strftime("%Y-%m-%d %I:%M%p") %></td>
            <td>
              <% if export.long_done && export.long_format_url %>
                  <%= link_to 'long csv', project_long_format_responses_project_response_export_path(current_project, export.id) %>
              <% elsif export.long_format_url && !export.long_done %>
                  Processing...
              <% end %>
            </td>
            <td>
              <% if export.wide_done && export.wide_format_url %>
                  <%= link_to 'wide csv', project_wide_format_responses_project_response_export_path(current_project, export.id) %>
              <% elsif export.wide_format_url && !export.wide_done %>
                  Processing...
              <% end %>
            </td>
            <td>
              <% if export.short_done && export.short_format_url %>
                  <%= link_to 'short csv', project_short_format_responses_project_response_export_path(current_project, export.id) %>
              <% elsif export.short_format_url && !export.short_done %>
                  Processing..
              <% end %>
            </td>
            <td>
              <% if policy(export).project_response_images? && export.response_images_export && export.response_images_export.download_url %>
                  <%= link_to 'pictures', project_response_images_project_response_export_path(current_project, export.id) %>
              <% end %>
            </td>
            <td><%= "#{ export.percent_complete(export.project) } %" %></td>
          </tr>
      <% end %>
      </tbody>
    </table>

    <div class="clearfix"><br/></div>

    <div class="block-header text-center text-capitalize">
      <h2><i class="md-file-download c-indigo"> Instrument Exports </i></h2>
    </div>
    <table class="table table-hover">
      <thead>
      <tr>
        <th>ID</th>
        <th>Instrument</th>
        <th>Versions</th>
        <th>Date</th>
        <th>Long format</th>
        <th>Wide format</th>
        <th>Short format</th>
        <th>Pictures</th>
        <th>% Complete</th>
      </tr>
      </thead>
      <tbody>
      <% @instrument_exports.each do |export| %>
          <tr>
            <td><%= link_to export.id, project_response_export_path(current_project, export) %></td>
            <td><%= link_to current_project.instruments.find(export.try(:instrument_id)).try(:title), project_instrument_path(current_project, export.try(:instrument_id)) %></td>
            <td>
              <% export.try(:instrument_versions).try(:each) do |instrument_version| %>
                  <%= link_to instrument_version, project_instrument_version_path(current_project, current_project.instruments.find(export.try(:instrument_id)).try(:id), instrument_version) %>
              <% end %>
            </td>
            <td><%= export.created_at.strftime("%Y-%m-%d %I:%M%p") %></td>
            <td>
              <% if export.long_done && export.long_format_url %>
                  <%= link_to 'long csv', instrument_long_format_responses_project_response_export_path(current_project, export.id) %>
              <% elsif export.long_format_url && !export.long_done %>
                  Processing...
              <% end %>
            </td>
            <td>
              <% if export.wide_done && export.wide_format_url %>
                  <%= link_to 'wide csv', instrument_wide_format_responses_project_response_export_path(current_project, export.id) %>
              <% elsif export.wide_format_url && !export.wide_done %>
                  Processing...
              <% end %>
            </td>
            <td>
              <% if export.short_done && export.short_format_url %>
                  <%= link_to 'short csv', instrument_short_format_responses_project_response_export_path(current_project, export.id) %>
              <% elsif !export.short_done && export.short_format_url %>
                  Processing...
              <% end %>
            </td>
            <td>
              <% if export.response_images_export && export.response_images_export.download_url %>
                  <%= link_to 'pictures', instrument_response_images_project_response_export_path(current_project, export.id) %>
              <% end %>
            </td>
            <td> <%= "#{ export.percent_complete(export.instrument) } %" %> </td>
          </tr>
      <% end %>
      </tbody>
    </table>
  </div>
</section>
