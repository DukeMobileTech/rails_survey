<section class="widget">
  <header>
    <h4><i class="icon-edit"></i> Instruments</h4>
  </header>
  <div class="body">
    <%= form_for @instrument do |f| %>
      <% if @instrument.errors.any? %>
        <div class="error_messages">
          <h2><%= pluralize(@instrument.errors.count, "error") %> prohibited this survey from being saved:</h2>
          <ul>
          <% @instrument.errors.full_messages.each do |msg| %>
            <li><%= msg %></li>
          <% end %>
          </ul>
        </div>
      <% end %>

      <div class="field bottom-buffer">
        <%= f.label :title, 'Instrument Title' %><br />
        <%= f.text_field :title, class: 'form-control' %>
      </div>

      <div class="field bottom-buffer">
        <%= f.label :language %>
        <%= f.select(:language, options_for_select(Settings.languages, @instrument.language)) %>
      </div>

      <div class="sortable hidden">
        <% @instrument.questions.each do |question| %>
        <div class="row top-buffer question-row">
          <div class="span-1">
            <input class="selected-checkbox" type="checkbox">
          </div>
          <div class="span-1">
            <strong><p class="question-number"><%= question.number_in_instrument %></p></strong>
          </div>
          <div class="span-2">
            <a class="btn btn-default move-question"><i class="icon-move"></i></a>
            <a class="btn btn-default edit-question"><i class="icon-pencil"></i></a>
            <a class="btn btn-danger delete-question"><i class="icon-trash"></i></a>
          </div>
          <div class="span-8">
            <p><%= question.text %></p>
          </div>
        </div>
        <% end %>
      </div>

      <%= f.fields_for :questions do |builder| %>
        <%= render 'question_fields', f: builder %>
      <% end %>
      <%= link_to_add_fields "Add Question", f, :questions, class: 'btn btn-success top-buffer' %>
      
      <div class="top-buffer pull-right">
        <%= f.submit class: 'btn btn-primary btn-large' %>
      </div>
    <% end %>
  </div>
</section>
