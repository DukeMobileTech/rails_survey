underscore = angular.module('underscore', [])
underscore.factory '_', ->
  window._

window.App = angular.module('Survey',
  ['ngResource', 'ngAnimate', 'ngSanitize', 'ngCookies', 'ngMessages', 'ui.router',
  'ui.sortable', 'ui.keypress', 'ui.bootstrap', 'angular-loading-bar',
  'angularFileUpload', 'xeditable', 'angularUtils.directives.dirPagination',
  'textAngular', 'checklist-model', 'angular.filter', 'underscore', 'templates'
  ]).config(['$stateProvider', '$urlRouterProvider', '$locationProvider',
  ($stateProvider, $urlRouterProvider, $locationProvider) ->
    # TODO Why is locationProvider needed for routeProvider to work?
    $locationProvider.html5Mode
      enabled: true
      requireBase: false

    $stateProvider
      .state 'questionSets',
        url: '/question_sets'
        # template: '<h1>Test</h1>'
        templateUrl: "<%= asset_path('question_sets/index.html') %>"
        controller: 'QuestionSetsCtrl'
      .state 'questionSet',
        url: '/question_sets/:id'
        templateUrl: "<%= asset_path('question_sets/show.html') %>"
        controller: 'ShowQuestionSetCtrl'
      .state 'questionSetquestions',
        url: '/question_sets/:question_set_id/questions/:id'
        templateUrl: 'questions/show.html'
        controller: 'ShowQuestionCtrl'
      .state 'questionSetNewQuestion',
        url: '/question_sets/:question_set_id/questions/new'
        templateUrl: 'questions/show.html'
        controller: 'ShowQuestionCtrl'
      .state 'optionSets',
        url: '/option_sets'
        templateUrl: 'option_sets/index.html'
        controller: 'OptionSetsCtrl'
      .state 'optionSet',
        url: '/option_sets/:id'
        templateUrl: 'option_sets/show.html'
        controller: 'ShowOptionSetCtrl'
      .state 'instructions',
        url: '/instructions'
        templateUrl: 'instructions/index.html'
        controller: 'InstructionsCtrl'
      .state 'instruction',
        url: '/instructions/:id'
        templateUrl: 'instructions/show.html'
        controller: 'ShowInstructionCtrl'
      .state 'instrumentQuestionSets',
        url: '/projects/:project_id/instruments/:instrument_id/instrument_question_sets'
        templateUrl: 'instrument_question_sets/index.html'
        controller: 'InstrumentQuestionSetsCtrl'
      .state 'instrumentQuestions',
        url: '/projects/:project_id/instruments/:instrument_id/instrument_questions'
        templateUrl: 'instrument_questions/index.html'
        controller: 'InstrumentQuestionsCtrl'
      .state 'instrumentQuestion',
        templateUrl: 'instrument_questions/show.html'
        controller: 'ShowInstrumentQuestionCtrl'
      .state 'displays',
        url: '/projects/:project_id/instruments/:instrument_id/displays'
        templateUrl: 'displays/index.html'
        controller: 'DisplaysCtrl'
      .state 'display',
        url: '/projects/:project_id/instruments/:instrument_id/displays/:id'
        templateUrl: 'displays/show.html'
        controller: 'ShowDisplayCtrl'
      .state 'optionTranslations',
        url: '/option_translations'
        templateUrl: 'option_translations/index.html'
        controller: 'LanguageTranslationsCtrl'
      .state 'languageOptionTranslation',
        url: '/option_translations/:language'
        templateUrl: 'option_translations/show.html'
        controller: 'OptionTranslationsCtrl'
      .state 'questionTranslations',
        url: '/question_translations'
        templateUrl: 'question_translations/index.html'
        controller: 'LanguageTranslationsCtrl'
      .state 'languageQuestionTranslations',
        url: '/question_translations/:language'
        templateUrl: 'question_translations/show.html'
        controller: 'QuestionTranslationsCtrl'
      .state 'instructionTranslations',
        url: '/instruction_translations'
        templateUrl: 'instruction_translations/index.html'
        controller: 'LanguageTranslationsCtrl'
      .state 'languageInstructionTranslations',
        url: '/instruction_translations/:language'
        templateUrl: 'instruction_translations/show.html'
        controller: 'InstructionTranslationsCtrl'

    # $urlRouterProvider.otherwise('/')
  ])

App.controller 'ProjectCtrl', ['$scope', ($scope) ->
  $scope.baseUrl = ''
  if _base_url != '/'
    $scope.baseUrl = _base_url
]
